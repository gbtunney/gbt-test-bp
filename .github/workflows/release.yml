name: 🚀 Final Release

on:
    push:
        branches: [main]

jobs:
    setup:
        uses: ./.github/workflows/setup-node-pnpm.yml
        with:
            install: true
            fix: false
            test: false
            build: false
            check: false

    block-if-dirty:
        runs-on: ubuntu-latest
        needs: setup
        if: needs.setup.outputs.dirty == 'true'
        steps:
            - run: |
                  echo "❌ Refusing to release from a dirty repo:"
                  echo '${{ needs.setup.outputs.files }}' | jq .
                  exit 1

    release:
        runs-on: ubuntu-latest
        needs: setup
        if: needs.setup.outputs.dirty == 'false'
        steps:
            - uses: actions/checkout@v4
            - run: echo "✅ Proceed with tag and publish"
