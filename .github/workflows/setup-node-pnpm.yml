name: setup-node-pnpm

on:
    workflow_call:
        inputs:
            install:
                type: boolean
                default: true
            build:
                type: boolean
                default: false
            fix:
                type: boolean
                default: false
            test:
                type: boolean
                default: false
            check:
                type: boolean
                default: false
        outputs:
            dirty:
                value: ${{ jobs.repo.outputs.dirty }}
            files:
                value: ${{ jobs.repo.outputs.files }}

jobs:
    repo:
        uses: ./.github/workflows/log-repo-status.yml
        with:
            LOG_DIRTY_FILES: true
            LOG_IGNORED: true
            DEBUG: true

    setup:
        runs-on: ubuntu-latest
        needs: repo
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: '20.11.1'
            - run: npm install -g pnpm
            - if: ${{ inputs.install }}
              run: pnpm install --frozen-lockfile
            - if: ${{ inputs.build }}
              run: pnpm build
            - if: ${{ inputs.fix }}
              run: pnpm fix
            - if: ${{ inputs.test }}
              run: pnpm test
            - if: ${{ inputs.check }}
              run: pnpm check
