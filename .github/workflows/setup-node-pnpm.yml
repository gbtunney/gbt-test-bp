name: setup-node-pnpm

on:
    workflow_call:
        inputs:
            install:
                type: boolean
                default: true
            build:
                type: boolean
                default: true
            fix:
                type: boolean
                default: false
            test:
                type: boolean
                default: false
            check:
                type: boolean
                default: false
        outputs:
            dirty:
                value: ${{ jobs.setup.outputs.dirty }}
            files:
                value: ${{ jobs.setup.outputs.files }}

jobs:
    setup:
        runs-on: ubuntu-latest
        outputs:
            dirty: ${{ steps.log.outputs.dirty }}
            files: ${{ steps.log.outputs.files }}
        steps:
            - name: ğŸ›ï¸ Checkout repository
              uses: actions/checkout@v4

            - name: ğŸ§° Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20.11.1'

            - name: ğŸ“¦ Install pnpm
              run: npm install -g pnpm

            - name: ğŸ“¥ Install dependencies
              if: ${{ inputs.install }}
              run: pnpm install --frozen-lockfile

            - name: ğŸ› ï¸ Build packages
              if: ${{ inputs.build }}
              run: pnpm build

            - name: ğŸ”§ Auto-fix code
              if: ${{ inputs.fix }}
              run: pnpm fix

            - name: ğŸ§ª Run tests
              if: ${{ inputs.test }}
              run: pnpm test

            - name: âœ… Lint and check
              if: ${{ inputs.check }}
              run: pnpm check
